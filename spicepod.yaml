version: v1beta1
kind: Spicepod
name: f5-nginx

datasets:
# TODO: host somewhere
 # - from: file://Users/jeadie/Github/spiceai/nginx_cve.csv
 #   name: local_cve
 #   embeddings:
 #     - column: description
 #       use: hf_minilm

 - from:  s3://spiceai-demo-datasets/nginx
   name: nginx_cve
   params:
     file_format: json
   embeddings:
     - column: description
       use: hf_minilm

 - from: s3://spiceai-demo-datasets/nginx/tickets/
   name: nginx_tickets
   acceleration:
     enabled: true
   params:
     file_format: csv
     csv_schema_infer_max_records: 10
   embeddings:
     - column: description
       use: hf_minilm

 # - from: graphql:https://api.github.com/graphql
 #   name: nginx_commits
 #   embeddings:
 #     - column: description
 #       use: hf_minilm
 #   acceleration:
 #     enabled: true
 #   params:
 #     unnest_depth: 1
 #     graphql_auth_token: ${ secrets:GITHUB_TOKEN }
 #     json_pointer: /data/repository/defaultBranchRef/target/history/nodes
 #     graphql_query: |
 #        {
 #          repository(owner: "nginx", name: "nginx") {
 #            defaultBranchRef {
 #              target {
 #                ... on Commit {
 #                  history(first: 100, after: $cursor) {
 #                    pageInfo {
 #                      hasNextPage
 #                      endCursor
 #                    }
 #                    nodes {
 #                      message
 #                      messageHeadline
 #                      messageBody
 #                      oid
 #                      additions
 #                      deletions
 #                      id
 #                      committedDate
 #                      committerName: committer {
 #                        name
 #                      }
 #                      committerEmail: committer {
 #                        email
 #                      }
 #                    }
 #                  }
 #                }
 #              }
 #            }
 #          }
 #        }

embeddings:
  - name: hf_minilm
    from: huggingface:huggingface.co/sentence-transformers/all-MiniLM-L6-v2

models:
  - name: openai
    from: openai/gpt-4o
    params:
      openai_api_key: ${ secrets:SPICE_OPENAI_API_KEY }

  - name: groq
    from: openai/llama-3.1-8b-instant
    params:
      endpoint: https://api.groq.com/openai/v1
      openai_api_key: ${ secrets:SPICE_GROQ_API_KEY_1 }

  - name: groq2
    from: openai/llama-3.1-8b-instant
    params:
      endpoint: https://api.groq.com/openai/v1
      openai_api_key: ${ secrets:SPICE_GROQ_API_KEY_2 }
